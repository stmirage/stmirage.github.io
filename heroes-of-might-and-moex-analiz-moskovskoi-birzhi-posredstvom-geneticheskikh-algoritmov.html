<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Heroes of might and MOEX. Анализ московской биржи посредством генетических алгоритмов
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
            <link href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&amp;display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/theme/css/main.css">
        <link rel="stylesheet" href="/theme/css/stars.css">
        <link rel="stylesheet" href="/theme/css/gray.css">

    <link rel="stylesheet" href="/theme/css/blog.css">
    <link rel="stylesheet" href="/theme/css/github.css">
        <!-- <script src="/theme/js/vendor/modernizr-2.6.2.min.js"></script> -->
        <link rel="shortcut icon" href="/images/favicon.png" />

    </head>
    <body class="">
        <div id="page" class="site palette-yellow">
      
      <header id="masthead" class="site-header bg--loaded">

        <div id="header-bg" class="site-header-bg" style="background-image:url('/images/DATAscience.png')">
          </div>
        <div class="site-header-scroll">
          <div class="site-header-inside">
            <div class="site-header-vertical">
              <div class="site-branding">
                <p class="site-logo">

                </p>
                <p class="site-description">Stmirage projects page</p>
              </div>
              <nav id="main-navigation" class="site-navigation" aria-label="Main Navigation">

                <div class="site-nav-wrap">
                  <div class="site-nav-inside">
                    <ul class="menu">
                      <li class="menu-item current-menu-item">
                        <a href="/">Главная</a>
                      </li>
                      <li class="menu-item">
                        <a href="/pages/kontakty">Контакты</a>
                      </li>
                      <li class="menu-item">
                        <a href="/pages/vse-proekty">Все проекты</a>
                      </li>
                    </ul>

                  </div>
                </div>
              </nav>

              <button id="menu-toggle" class="menu-toggle">
                <span class="screen-reader-text">Menu</span>
                <span class="icon-menu" aria-hidden="true"></span>
              </button>
            </div>
          </div>
        </div>
      </header>


<!--

        <footer id="colophon" class="site-footer inner">
          <div class="site-footer-inside">
            <span class="copyright">Опубликовано с удовольствием 2019-2020</span>
          </div>
        </footer>  
-->





        <div id="content" class="site-content">
        <main id="main" class="site-main inner">

    <div id="post-container">
                <article class="post-entry">
                    <header class="entry-header">
                        <time>
                            22.02.2021
                        </time>
                        <a href="/heroes-of-might-and-moex-analiz-moskovskoi-birzhi-posredstvom-geneticheskikh-algoritmov.html" rel="bookmark"><h1>Heroes of might and MOEX. Анализ московской биржи посредством генетических алгоритмов</h1></a>
                    </header>

                    <section class="post-content">
                        <blockquote>
<p>«Рынок — это система с бесконечным числом степеней свободы, и смоделировать ее имеющимися у нас средствами можно только очень грубо. Создав какую-то МТС на основе существующих на этот момент наблюдений, мы, конечно, будем иметь некоторое приближение к реальной ситуации, но чем дальше по времени, тем хуже будет точность воспроизведения, а в перспективе модель и рынок будут жить совершенно независимо друг от друга, не принося, понятное дело, создателю ни гроша. Самая лучшая иллюстрация здесь — прогноз погоды. На два дня — очень точный, на пять — туда сюда, а на десять — невозможен, в том смысле, что абсолютно бесполезен.»</p>
<p>-- <cite>Один из отзывов на книгу «Маленькая книга победителя рынка акций» Джоэла Гринблата, приведенный в самой книге и полностью противоположный содержанию этой книги.</cite></p>
</blockquote>
<h2>Генетические алгоритмы исследуют Московскую фондовую биржу</h2>
<p>В отсутствие других хороших идей, я снова занялся вопросами инвестирования. Прочитав несколько книг и определенное количество статей, я пришел к ужасающему выводу: в них очень мало совпадающих от книги к книге рекомендаций.</p>
<ul>
<li>В книгах для трейдеров всё внимание уделено техническим краткосрочным скачкам акций. Эти книги не имеют никакого отношения к инвестированию.</li>
<li>Книги по инвестированию(даже те, которые считаются классическими) содержат крайне путанную информацию на чём сосредоточить внимание. Описать в двух словах сумму рекомендаций по покупке акций можно так: Компания с низкими долгами, издержками и стоимостью, но зато с прекрасным будущим, сильными позициями на рынке и высокой эффективностью.</li>
</ul>
<p>Но на чём конкретно стоит сфокусироваться? Размеру компании? Долгам? Активам? Отрасли? Эффективному менеджменту?</p>
<p>Опросив друзей и прочитав несколько каналов в телеграме, я осознал:</p>
<ul>
<li>В их действиях полно достаточно случайных моментов, сиюминутных решений.</li>
<li>Убеждения носят очень общий характер. Ориентировка на конкретный показатель компании, любовь к отрасли и проч.</li>
<li>Часть убеждений легко формализуется. <em>Например, у компании уменьшаются долги</em></li>
<li>Часть из них реализовать алгоритмически тоже можно, но я не представляю как. Один знакомый сказал, что часто поглядывает во что вкладываются самые богатые и влиятельные люди. Намекая на то, что сам факт покупки ими активов говорит о том, что они готовы своей властью и деньгами улучшать состояние актива. Мудро, но написать бота, который соберет пласт публикаций и выделит из общедоступных источников такую информацию за много лет сложно. </li>
</ul>
<p>Решил, что немного надоело возиться с решающими деревьями и нейросетями. Для простых и понятных взглядов можно сделать что-то попроще и попонятнее. </p>
<p>Выбрал то, чем обычно мало занимаются в дата сайенсе на практике - генетические алгоритмы.</p>
<p>Основная суть идеи:</p>
<ol>
<li>Мы создадим ботов со случайным набором основных понятных мне убеждений.</li>
<li>Каждый бот независимо от других проживет полноценную жизнь как инвестор за определенный период продавая и покупая акции согласно своим убеждениям.</li>
<li>В конце хода, мы оставим тех, чей итоговый доход больше 90% остальных ботов. Сохраним лучший генофонд</li>
<li>Добавим мутировавшие копии с несколько измененными взглядами случайным образом.</li>
<li>Добавим некоторое количество абсолютно случайных ботов для поиска новых удачных мутаций.</li>
<li>Повторим для новой партии с третьего пункта и проделаем эту операцию много-много раз.</li>
</ol>
<h2>Убеждения</h2>
<p>Убеждение состоит из двух частей: некое правило, по которому покупка/продажа акции осуществляется или отсеивается, а также сила этого убеждения. У бота независимо друг от друга существуют взгляды на то какие акции покупать и какие акции продавать.</p>
<p>Основные виды правил:</p>
<ul>
<li>Бот может любить или ненавидеть акции конкретной компании.</li>
<li>Любить или ненавидеть конкретный сектор производства. От фанатичной скупки банковского сектора до готовности положить деньги под подушку,чтобы только не связываться с энергетиками.</li>
<li>Любить / ненавидеть покупать или продавать что-либо в принципе. От того, кто покупает акции и тут же все продает, до того, который думает несколько месяцев, чтобы купить навсегда.</li>
<li>Он может сравнивать финансовые показатели такие как капитализации, уровня задолженности или дивидендного дохода(их очень много таких показателей, перечислять не буду) со значения остальных команий по рынку. Например, предпочитать топ 10 самых загруженных долгами компаний.</li>
<li>Он может оценивать падение или рост каждого показателя за последние несколько лет. Например, предпочитать к покупке компании, чей дивидендный доход рос последние два года. Варьируется сам показатель и количество отслеживаемых лет.</li>
</ul>
<p>Всего у бота может быть 10 убеждений о мире — по пять на покупку и продажу. Слишком увлекаться не стоит. может получиться очень подогнанный под датасет итог.</p>
<p>Почему пять? Те, с кем я разговаривал и я сам обычно пишут список из 10 пунктов, что влияет на их покупки. Пять простых и вычислимых, а пять относятся к техническому анализу, мнению аналитиков и проч.</p>
<h2>Что мы хотим получить?</h2>
<p>Идеальный взгляд на инвестирование простыми словами.</p>
<h2>Как происходит покупка или продажа</h2>
<p>Добавим немного случайности из мира настольных ролевых игр. Ведь без случайного шума:</p>
<ul>
<li>Очень высока вероятность подогнать ответ под конкретно имеющиеся исторические данные, не имеющие ничего общего с будущим.</li>
<li>Уменьшится вариативность покупок. Финансовые показатели изменяются очень плавно у крупных компаний, и выбрав одну бот скорее всего будет и дальше её покупать, что не соответствует поведению реального инвестора, стремящегося к разнообразию в акциях.</li>
<li>Мы хотим, чтобы боты максимально похоже себя вели на настоящих людей, которые обычно не видят всех показателей и не способны проанализировать всё. Иногда подходящая примерно по взглядам акция просто попадает на глаза в нужный момент.</li>
</ul>
<p>Бот бросает некоторое количество игровых кубиков. Далее добавляются модификаторы убеждений, бот ранжирует акции по значимости и старается купить самые подходящие его взглядам.</p>
<p>Кубики гарантируют, что какой-то шанс есть у всех акций. Просто чаще всего будут выпадать подходящие под верования бота, иногда промелькивать недотягивающие по ряду параметрам. Совсем редко будут в портфеле появляться совершенно неподходящие.</p>
<h2>Технические особенности и Датасет</h2>
<table>
<thead>
<tr>
<th align="center"><img alt="Таблицы" src="/images/stock_excel.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Оказалось всё легче найти в экселе, чем в каком-то API</em></td>
</tr>
</tbody>
</table>
<p>Алгоритм очень долго работал. Даже после того, как я закешировал часть данных и переписал методы так, чтобы разбить вычисления на все ядра процессора — вышло очень медленно. За ночь мне удалось совершить только 9 эпох. Тем не менее убеждения начали сходиться, из случайно собранных новые убеждения не побеждали лучших из укоренившихся, шла только шлифовка, так что результаты адекватные.</p>
<p>В качестве датасета были взяты стоимости акций с 2015 по 2018 год включительно, дивидендные выплаты. У меня были данные о максимальной, минимальной, средней цене, а также цене открытия и закрытия торгов.</p>
<p>Вначале я строил сложные распределения, чтобы интерполировать случайные цены между минимумом и максимумом, а потом решил не запариваться и брать случайное число из вышепредставленных за первые 10 дней месяца. (лишь бы не напарываться на выплаты дивидендов. Около этих дат цена на акции аномальна).</p>
<p>Дивиденды по владению акциями выплачивались честно — для получения дивидендов акции должны быть куплены до определенного дня согласно графику.</p>
<p>Показатели за несколько лет в структурированном виде я нашел не для всей Московской биржи, а только для 50 крупнейших компаний, которые в сумме дают 95+ процентов капитализации всего рынка. Так что боты не смогут делать диких ставок на маленькие и волантильные компании, оперируя основным индексом Мосбиржи.</p>
<h2>Финансисты мира меча и магии. Судьба огненной птицы Каррен</h2>
<p>Через какое-то время ориентироваться в запущенных процессах и прогрессе ботов стало невозможно из-за их количества. Чтобы как-то различать, выдал им настоящие английские имена и фамилии. Стало лучше, но добавил еще им приставки в виде всех названий существ из игры «Герои меча и Магии 3». Получилось очень грустная и глубокая симуляция. О том, что когда эти существа воюют и погибают десятками тысяч, ты не видишь в них личностей. А ведь за каждым своя история.</p>
<table>
<thead>
<tr>
<th align="center"><img alt="Герои нашего двора" src="/images/homm.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Герои меча и магии с именами и фамилиями</em></td>
</tr>
</tbody>
</table>
<p>По итогам ночи на экране засветилась очень глубокая и личная история победителя. Перевести с языка цифр можно так.</p>
<p><em>Вставить картинку с птицей, если Вова успеет</em></p>
<p>Огненная птица Карен Калдвелл стала лучшим инвестором Московской фондовой биржи по итогам 2015-2018 года. </p>
<p>Главным правилом при покупке акций для Карен была эффективность: </p>
<ul>
<li>Коэфициент рентабельности активов, показывающий процентное соотношение чистой прибыли предприятия к его общим активам.</li>
<li>Количество прибыли, которая компания получила по отношению к сумме проданной продукции.</li>
</ul>
<p>Подобных же взглядов придерживались все остальные лучшие финансисты того времени:</p>
<ul>
<li>Другая огненная птица Дэвид Гарсия</li>
<li>Король Минотавров Томас Родригез</li>
<li>Боевой Единорог Анджела Браун</li>
</ul>
<p>У всех них были небольшие разночтения по поводу насколько эффективной должна быть компания. 
Все обожали привилегированные акции «Татнефть», недолюбливали покупать «Дальневосточное Пароходство». Анджела не любила акции «МВидео».</p>
<p>Каждый месяц с января 2015 года все они вкладывали по 100000 рублей в акции крупнейших компаний (Вложив всего 4.8 млн. рублей за 4 года) и все пришли к результату около 14 млн. рублей с небольшими различиями.</p>
<p>Все придерживались очень похожих взглядов на продажу акций:</p>
<ul>
<li>Ненавидели продавать акции. Каждый из них сто раз думал прежде, чем что-то продать. Кроме Анджелы. Ей было всё равно, но и заработала она немного меньше остальных.</li>
<li>Старались реже продавать дорогие акции. Буквально дорогие — те самые, где минимальная покупка подразумевает 1 дорогую акцию в несколько тысяч, а не лот из 100000 акций стоимостью несколько копеек.</li>
<li>Не любили продавать Акциии «Сбербанка». Хотя большинство не видело ни разу этих акций. Особенно решение о продаже не любил Король Минатвров Томас, хотя Сбербанк не получал никаких преференций о покупке. Просто если бы теоретически у Томаса каким-то образом оказалась акция «Сбербанк», он бы не стал её продавать. </li>
<li>Продавали акции компании с высокой долговой нагрузкой. </li>
<li>Если отношение цены акции к чистой прибыли компании выросло за последний год — акцию предпочтительнее было оставлять</li>
</ul>
<h2>Анализ</h2>
<p>Рассмотрим полученную информацию и оставим задел на уже более серьезный анализ.</p>
<ul>
<li>Все предпочтения связанные с любимой компанией совершенно бесполезны и скорее подтверждают теорию о том, что не надо выбирать любимую компанию. В нашем случае Татнефть. Но в начале периода вы не знаете, какая из сотен компаний покажет успех. Много «любимых» компаний не показали успеха. Если бы в итоге осталось несколько компаний с какими-то общими свойствами, можно было бы о чём-то говорить. </li>
<li>Среди существ заработавших сопоставимые суммы денег были те, кто уделял важное место выросшей за последние год или два инвестиционной программе компании. Где причина, а где следствие тут не очень понятно. Возможно у успешных и прибыльных компаний есть возможности для инвестирования в деятельность саму компанию. А может быть именно инвестирование денег на развитие компании делает её более прибыльной. Особенно любили это Гном Шин Мартин и Крестьянин Эдвард Шварц. Они заработали тоже около 14 млн. рублей по итогам.</li>
<li>Основные выводы вполне интуитивно вяжутся с большинством аналитиков — компании с эффективным управлением и низкими долгами лучше.</li>
<li>Единственным контринтуитивным показателем оказалось, что повышение коэфициента P/E говорит о том, что акцию продавать не стоит. Этот коэфициент чем меньше в жизни тем лучше. Он говорит о том, насколько быстро окупится ваша покупка. 1 значит, что ваши вложения в акцию вернутся через год. Возможно, речь о том, что раз он повысился, значит вы уже купили его на нужной отметке. Но влияние фактора в цифрах небольшое. Интерпретировать можно как угодно.</li>
</ul>
<p>Повторюсь то с чего начал статью — не надо опираться на эти данные, статья ни к чему не призывает. Это, как и всё,что я делаю умственное упражнение без прогностической ценности. Я не отвечаю за ваши действия. Финансовые операции требуют огромной ответственности от участника, и не терпят никаких советов. А сам я легко допускаю ошибки в рассуждениях.</p>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="/category/machinelearning.html">MachineLearning</a></p>
                    </aside>
                    <hr/>
                </article>
    </div>
        </main>
        <footer id="colophon" class="site-footer inner">
          <div class="site-footer-inside">
            <span class="copyright">Опубликовано с удовольствием 2019-2020</span>
          </div>
        </footer>
      </div>

        </div>

        <script src="/theme/js/main.js" type="text/javascript"></script>
        <script src="/theme/js/plugins.js" type="text/javascript"></script>
        <!-- Yandex.Metrika counter -->
        <script type="text/javascript" >
           (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
           m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
           (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

           ym(69735988, "init", {
                clickmap:true,
                trackLinks:true,
                accurateTrackBounce:true
           });
        </script>
        <noscript><div><img src="https://mc.yandex.ru/watch/69735988" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
        <!-- /Yandex.Metrika counter -->
    </body>



<!--               

 -->