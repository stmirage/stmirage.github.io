<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Пищевая бездна. Исследование рецептов сайта Поваренок. Часть 1
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
            <link href="https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i&amp;display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/theme/css/main.css">
        <link rel="stylesheet" href="/theme/css/stars.css">
        <link rel="stylesheet" href="/theme/css/gray.css">

    <link rel="stylesheet" href="/theme/css/blog.css">
    <link rel="stylesheet" href="/theme/css/github.css">
        <!-- <script src="/theme/js/vendor/modernizr-2.6.2.min.js"></script> -->
        <link rel="shortcut icon" href="/images/favicon.png" />

    </head>
    <body class="">
        <div id="page" class="site palette-yellow">
      
      <header id="masthead" class="site-header bg--loaded">

        <div id="header-bg" class="site-header-bg" style="background-image:url('/images/DATAscience.png')">
          </div>
        <div class="site-header-scroll">
          <div class="site-header-inside">
            <div class="site-header-vertical">
              <div class="site-branding">
                <p class="site-logo">

                </p>
                <p class="site-description">Stmirage projects page</p>
              </div>
              <nav id="main-navigation" class="site-navigation" aria-label="Main Navigation">

                <div class="site-nav-wrap">
                  <div class="site-nav-inside">
                    <ul class="menu">
                      <li class="menu-item current-menu-item">
                        <a href="/">Главная</a>
                      </li>
                      <li class="menu-item">
                        <a href="/pages/kontakty">Контакты</a>
                      </li>
                      <li class="menu-item">
                        <a href="/pages/vse-proekty">Все проекты</a>
                      </li>
                    </ul>

                  </div>
                </div>
              </nav>

              <button id="menu-toggle" class="menu-toggle">
                <span class="screen-reader-text">Menu</span>
                <span class="icon-menu" aria-hidden="true"></span>
              </button>
            </div>
          </div>
        </div>
      </header>


<!--

        <footer id="colophon" class="site-footer inner">
          <div class="site-footer-inside">
            <span class="copyright">Опубликовано с удовольствием 2019-2020</span>
          </div>
          <a id="to-top" class="to-top" href="https://themes.stackbit.com/demos/fjord/#page">
            To top
            <span class="icon-arrow-up" aria-hidden="true"></span>
          </a>
        </footer>  
-->





        <div id="content" class="site-content">
        <main id="main" class="site-main inner">

    <div id="post-container">
                <article class="post-entry">
                    <header class="entry-header">
                        <time>
                            23.11.2020
                        </time>
                        <a href="/pishchevaia-bezdna-issledovanie-retseptov-saita-povarenok-chast-1.html" rel="bookmark"><h1>Пищевая бездна. Исследование рецептов сайта Поваренок. Часть 1</h1></a>
                    </header>

                    <section class="post-content">
                        <p>Первоначальная статья о моём небольшом проекте по анализу данных.Я хотел как обычно сделать маленькую страничку про проект. Но уж больно цель амбициозная. Главная цель - создание идеального рецепта новогоднего салата основываясь на датасете, собранным мной с поваренка. Это растянется на несколько статей. </p>
<blockquote>
<p>"Решила попробовать такой способ фарширования кабачков. А почему бы и нет? Получилось очень вкусно."</p>
<p>-- <cite>Автор совершенно отбитого на голову рецепта кабачка фаршированного вермишелью.</cite></p>
</blockquote>
<p>Инструменты для работы со статистикой:</p>
<ul>
<li>requests</li>
<li>Selenium</li>
<li>python</li>
<li>pandas</li>
<li>pygal</li>
<li>seaborn</li>
</ul>
<p>все изображения использованные при написании - собственность сайта поваренок</p>
<p>Каждый год я мучаюсь в попытках найти идеальный салат с кукурузой под новый год. Или просто салат. Или просто блюдо. Однажды я зашел на сайт со всякими полурекламными статьями и выбрал статью про 10 лучших салатов с кукурузой. Я протестировал каждый из этих салатов и пришел к выводу, что те, кто публикуют в интернете на платной основе сами своих блюд никогда не едят. Бездушные копирайтеры. </p>
<p><a href="https://lifehacker.ru/salaty-s-kukuruzoj-recepty/">Бездушный набор рецептов с кукурузой</a></p>
<p>Что можно взять как альтернативу? есть авторские кулинарные блоги. Но хотелось чего-то необычного. Да и датасет толком с одного повара не соскребешь. Мой взгляд в эту зиму упал на легенду российского интернета Povarenok.ru. Место, где пользователи сами публикуют рецепты.</p>
<p>Задача стоит простая и амбициозная - создать идеальный салат посредством машинного обучения. Начнем. В мире куча тупых статей, как нейросетки просто получают огромные корпуса текста, и генерируют примерный рецепт, как будто его писал реальный человек. Я постараюсь как можно меньше использовать текст, и ориентироваться на на сами данные.</p>
<p>Описать этот культурный в российской истории феномен достаточно сложно. Лучшим сравнением будет очень непростой вид искусства как <a href="https://yandex.ru/search/?clid=1882628&amp;text=ЖКХ%20арт&amp;l10n=ru&amp;lr=43">ЖКХ арт.</a>  Хаотичные украшения дворов из старых покрышек (Легендарный русский лебедь из покрышек чего стоит) , старых игрушек, странные изородованные временем лица сказочных персонажей. Очень самобытный и противоречивый вид искусства.</p>
<p>Поваренок - ЖКХ Арт мира кулинарии. У сайта слава ресурса, где неграмотные пользователи интернета выкладывают "хрючево" из несовместимых ингредиентов.  Вот только посмотрите на этот <a href="https://www.povarenok.ru/recipes/show/29970/">рецепт</a>. Этому явлению даже посвящены отдельные группы в соц.сетях. Поищите по запросу "Карательная кулинария". Авторы регулярно ругаются, но тем не менее у сайта есть своё крепкое сообщество, постики публикуются, регулярно проходят конкурсы. Причем очень часто! Пока я собирал дасет, прибирался в данных сменилось 3.</p>
<h2>Что нам известно?</h2>
<p>Изначально хотел написать скрапер на requests, просто забирая значение странички и парсить. Но рейтинг рецепта - целевое значение, на которое я буду опираться подгружается через некоторое время отдельным запросом и только если пользователь авторизован. В итоге решил не мучаться с получением сессии через запросы, а написал бота, который в реальном браузере заходит на странички и парсит нужные значения.</p>
<p>Его глаза увидели 136057 рецептов из заявленных на сайте bp 143444. Почему не все рецепты попали? Часть рецептов имеет странную верстку, которая осталась с какой-то рекламной компании и писать изменения в парсере на каждый такой рецепт очень затратно по времени. По части не вернулось отображение. К тому же на сайте очень странные id у рецептов. Например, последним на момент написания был 168564. Возможно, были какие-то чистки. Если верить сайту, то потеряно около 5% от общего количества, что можно считать допустимым. </p>
<p>Однако, мы обратим внимание на то, что среди потерянных были конкурсные работа, а там рейтинги зависят от активности пользователя по привлечению голосов.</p>
<p>Среди полезной информации, которая не была распарсена с сайта</p>
<ul>
<li>Сам процесс приготовления. Кто-то публиковал его голым текстом. Кто-то оформлял аккуратными блоками, где была картинка на каждом шаге. Это всё влияло на верстку страницы, и я не увидел смысла парсить эти описания. С одной стороны я не специалист по NLP, чтобы это всё приводить к адекватному для машинного обучения виду. Да и остальной информации в большинстве случаев более чем достаточно для понимания что перед нами. Способ приготовления или практически не имеет значения(Суп или салат почти всегода можно в каком-то виде воспроизвести по ингрединтам), либо так или иначе указан в тегах ("Жареное", "Вареное", "Духовка", "Крупным куском")</li>
<li>К тому же относятся комментарии</li>
<li>Имя автора. Немного жалею,что не взял. Это ценная информация о которой я просто забыл. Если получится - доскребу. Интересно было бы посмотреть, какое на сайте количество "рок-звезд"</li>
<li>Изображение. Может быть для отдельного проекта тоже соскребу все, эти изображения. было бы интересно попробовать написать нейросеть, которая генерирует все эти салатики и тортики</li>
</ul>
<p>Всё остальное, насколько я увидел на странице было взято и изучено. Для модели обучения и формулировки задачи будет отдельный пост, а пока посмотрим чем жив наш поваренок. В этом посте половина параметров. </p>
<h2>Названия</h2>
<p>В основном названия достаточно понятны и логичны. Содержат в себе тип блюда, особенный ингредиент и какое-то возвышенное название.</p>
<ul>
<li>Салат " Импровизация с печенью"</li>
<li>Литературное название ,которое ни о чем не говорит. "Мышкина радость" это два рецепта торта, и салат</li>
<li>Практически нет вида блюда без названия оригинальный</li>
<li>есть достаточно большое количество стандартных форм, которые используются для оформления еды. Например, по запросу "Цветок" можно найти цветок выложенный из огурцов, теста, сыра, лука, перца, моркови, редиса, ананаса, колбасы, риса, помидоров, свёклы, картофеля, дыни, мармелада, шоколада, острых перцев, квашеной капусты, мастики, мандаринов, рыбы, кабачков, ветчины, майонеза, кукурзы, рисовой бумаги, тыквы, ананасов и нескольких видов начинки. </li>
<li>Если в названии содержится зверь или персонаж, то высока вероятность, что это будет бомбически выглядеть. </li>
</ul>
<table>
<thead>
<tr>
<th align="center"><img alt="цветок" src="/images/Cvetok1.jpg"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Прекрасный цветок из сырого лука</em></td>
</tr>
</tbody>
</table>
<p>А теперь интерактив. Играем по следующим правилам: читаете название. Представляете, что там может быть. открываете ссылку. Вы победили.</p>
<p><a href="https://www.povarenok.ru/recipes/show/1383/">Торт черепаха в купальнике</a>
<a href="https://www.povarenok.ru/recipes/show/35429/">Торт "Пчёлка"</a>
<a href="https://www.povarenok.ru/recipes/show/92977/">Пчёлки из мастики</a>
<a href="https://www.povarenok.ru/recipes/show/26504/">пирог "Улитка Гери" из спанчбоба</a>
<a href="https://www.povarenok.ru/recipes/show/26095/">Слойки "Волк"</a>
<a href="https://www.povarenok.ru/recipes/show/43375/">Робот</a>
<a href="https://www.povarenok.ru/recipes/show/50556/">Крот</a></p>
<ul>
<li>
<p>Многие фантазии авторов, вообще, невозможно как-то интерпретировать, если не лезть в сам рецепт.</p>
<ul>
<li>"Белеет парус одинокий"</li>
<li>Курица «По-буржуйски» </li>
<li>Пицца-глазунья</li>
<li>Чебуреки с повидлом</li>
<li>"Магдалена",Аджика из кабачка.</li>
</ul>
</li>
<li>
<p>Есть много рецептов с интересными названиями и совершенно банальным рецептом внутри. Все эти рецепты не стоят вашего внимания</p>
<ul>
<li>Рис "Между нами девочками"</li>
<li>Салат придуманный 5-ти летним сыном</li>
<li>Двух слойный чай</li>
<li>Салат "Смертельный номер"</li>
<li>Грибы По-Венесуэльски</li>
</ul>
</li>
<li>Исследуя датасет, вы наверняка найдете давно забытое блюдо. Вот например очень простой <a href="https://www.povarenok.ru/recipes/show/737/">торт</a>, который готовила в детстве бабушка, когда было денег на сладости </li>
<li>Есть пользователи, которые реально вдохновляют своей работой, но имеют малое число баллов. Хороший рецепт или просто красивая работа - совсем не показатель успеха.<ul>
<li><a href="https://www.povarenok.ru/recipes/show/73164/">Самые красивые пчелы на сайте</a></li>
<li><a href="https://www.povarenok.ru/recipes/show/58515/">охрененный медведь</a> </li>
</ul>
</li>
<li>Иногда выкладывают фото семьи, делают к рецепту сюжет. <ul>
<li><a href="https://www.povarenok.ru/recipes/show/53146/">раз</a></li>
<li><a href="https://www.povarenok.ru/recipes/show/53133/">два</a></li>
</ul>
</li>
</ul>
<p>Посмотрим какие слова используются часто, а какие нет. Возьмем не сами слова, а корни, чтобы не мучаться со всеми склонениями
Да, мы смешиваем печенье и печень, но это нас пока не интересует пока. </p>
<table>
<thead>
<tr>
<th align="center">Название</th>
<th align="center">количество</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">салат</td>
<td align="center">15409</td>
</tr>
<tr>
<td align="center">курин</td>
<td align="center">9352</td>
</tr>
<tr>
<td align="center">пирог</td>
<td align="center">8482</td>
</tr>
<tr>
<td align="center">торт</td>
<td align="center">6400</td>
</tr>
<tr>
<td align="center">соус</td>
<td align="center">5630</td>
</tr>
<tr>
<td align="center">печен</td>
<td align="center">5496</td>
</tr>
<tr>
<td align="center">суп</td>
<td align="center">4505</td>
</tr>
<tr>
<td align="center">творожн</td>
<td align="center">3411</td>
</tr>
<tr>
<td align="center">кекс</td>
<td align="center">3375</td>
</tr>
<tr>
<td align="center">сыр</td>
<td align="center">3186</td>
</tr>
</tbody>
</table>
<p>Нам очень повезло. Самая крупная категория - 11% процентов рецетов - салаты.
Я в первый и последний раз привожу пример с таким количеством стоблбцов, чтобы показать, что все распределения в сете, где пользователям давали что-то выбирать. сначала 5-10 тегов самых топовых, потом резкое падение и почти бесконечный убывающий хвост распределения. На этом графике показаны 100 из ~ 17000 различных корней встречающихся в рецептах. там огромное количество мусора, недоработок библиотеки стемминга, которой я вынимаю корни и проч. В следующих графиках будет 10 основных характеристик, чтобы эти графики читались. </p>
<table>
<thead>
<tr>
<th align="center"><img alt="популярность" src="/images/chart4.svg"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Главное это салаты, курица и выпечка</em></td>
</tr>
</tbody>
</table>
<p>Отмечаем, что в целом Поваренок это форум для салатов и выпечки</p>
<h2>Даты</h2>
<p>Три основные тренды формирующие тренд поваренка</p>
<ul>
<li>Форум уже давно не так популярен, как в былые годы. Количество рецептов сначала взлетело, потом постепенно начало падать.</li>
</ul>
<table>
<thead>
<tr>
<th align="center"><img alt="популярность" src="/images/chart3.svg"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Популярность сайта среди авторов уже давно не та, что лет 10 назад</em></td>
</tr>
</tbody>
</table>
<ul>
<li>Ингредиенты имеют ярко выраженную сезонность. Вот график майонеза. Ярко выраженные пики публикаций под новый год.</li>
</ul>
<table>
<thead>
<tr>
<th align="center"><img alt="мазик" src="/images/chart2.svg"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Отметим, что популярность майонеза так высока в начале. Позже наступили времена кулинарного разнообразия</em></td>
</tr>
</tbody>
</table>
<p>Важный вопрос - влияет ли сезонность на рейтинг? правда ли, что тыква популярнее в октябре, когда публикуется много рецептов про тыкву, и много людей ищет эти рецепты? А за майонез люди активнее голосуют зимой больше зимой?</p>
<p>Я поигрался с разными ингредиентами, которые так или иначе я относил к сезонным. и не нашел прямых корреляций. Для примера вот, что происходит с тыквой: публикуют её рецепты в сезон, но голосуют в течение года совершенно непредсказуемо.</p>
<table>
<thead>
<tr>
<th align="center"><img alt="тыква" src="/images/chart5.svg"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Частота публикации тыквы относительно самой себя в разные месяцы</em></td>
</tr>
</tbody>
</table>
<p>а вот как популярны рецепты с тыквой по тем же месяцам</p>
<table>
<thead>
<tr>
<th align="center"><img alt="тыква" src="/images/chart6.svg"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Сравнение средних рейтингов блюд с тыквой</em></td>
</tr>
</tbody>
</table>
<p>Далее приходим к закономерной дилеме глядя на годы. в одни периоды посещаемость высокая. в другие низкая. Количество лайков может быть положительно коррелировано с количеством постов? Ведь если много постов, значит много людей, они чаще выставляют лайки. С другой стороны, если все постят, то ваше рецепт быстро затеряется и пропадет с главной страницы.</p>
<table>
<thead>
<tr>
<th align="center"><img alt="рейтинг" src="/images/chart7.svg"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Соотношение средних рейтингов за рецепты по месяцам</em></td>
</tr>
</tbody>
</table>
<p>Вообщем, вот еще одна диаграмма с кружочками для самостоятельного изучения. Самые крупные кружки - этомесяцы с самой высокой посещаемостью. Может показаться, что в пики посещаемости рейтинги действительно взлетали, но коэффициент коррелляции больше склоняет это к случайносму шуму</p>
<p>Коэфициенткорреляции Пирсона (рейтинг/месяц) = -0.16056599205403113 (практически шум)
p-value = 0.04386767193395407 &lt; 5%</p>
<p>Со всем остальным тоже не так очевидно. При расчет среднего рейтинга по месяцам сам месяц не влияет настолько сильно, насколько влияет год голосования. Отметим, что в 2010-2011 люди были гораздо щедрее на лайки. Посещаемость сайта коррелирует с количеством лайков.
На этапе feature selection я всё равно оставлю месяц публикации, потому что всё-таки для зимы данные достаточно аномальны с этими новогодними праздниками.</p>
<ul>
<li>Было ли влияние дней недели на популярность блюда? 
    Начнем с того, что пользователи людят понедельники. Больше всего публикуют по понедельникам, постепенно уменьшая активность вплоть до субботы, с вспышкой активности в воскресение. Разница в рейтинге не статистически значима. Но Волна убликаций от воскресения к понедельнику сохраняется всё время существования сайта. Вероятность того, что понедельник конкретной недели обгонит субботу этой же недели составляет примерно 2 к 1. Не понять, где тут причина, а где следствие.</li>
</ul>
<h2>Время</h2>
<p>не обнаружил связи между тем насколько востребован рецепт в какое-то время суток и рейтингом. примерно одинаковые позиции с совсем небольшой корреляцией - лучше публиковать после 12 ти ночи, но до 10 утра по Москве. Утренние просмотры свежих рецептов могут дать небольшой буст. </p>
<p>а вот большинство предпочитает публиковать свои рецептики после обеда и до вечера. Типичный график нагрузки на любой сайт.</p>
<table>
<thead>
<tr>
<th align="center"><img alt="тыква" src="/images/chart8.svg"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Немножко лучше публиковаться с утра.</em></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center"><img alt="тыква" src="/images/chart9.svg"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Ночью спят ,как и все</em></td>
</tr>
</tbody>
</table>
<h2>Просмотры</h2>
<p>Просмотры при создании рецепта мы никак не можем сделать признаком блюда. Однако мы можем оценить 2 параметра</p>
<ul>
<li>есть ли связь между количеством просмотров и итоговым рейтингом</li>
<li>Копится ли количество просмотров со временем у каждого рецепта. Возможно, у старых рецептов копится время</li>
</ul>
<p>Я убрал с графика выбросы - предельные значения по просмотрам и рейтингам. Основные зависимости
* Каждому уровню рейтинга - соответствует минимальное число просмотров. Хотя бы чтобы человек поставил лайк ему нужно зайти
* Высокое количество просмотров повышает шанс на высокий рейтинг, но не гарантирует его</p>
<table>
<thead>
<tr>
<th align="center"><img alt="тыква" src="/images/chart11.png"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Размазанное облако плотности говорит о том, что если просмотров много - не факт, что и лайков будет много</em></td>
</tr>
</tbody>
</table>
<h2>Наличие фото</h2>
<p>Наличие фото определенно играет важную роль. Самих рецептов не очень много без фото, и они практически все проигрывают обычным.</p>
<table>
<thead>
<tr>
<th align="center"><img alt="цветок" src="/images/chart12.svg"></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><em>Лучше всегда иметь красивое фото на рецепте</em></td>
</tr>
</tbody>
</table>
<h2>Рейтинги</h2>
<p>В следующей части мы посмотрим еще несколько закономерностей, но уже больше связанных со словами, вкусами, ингредиентами, национальными кухнями, пользовательскими всем, что не число. А еще попробуем отследить связь между калорийностью, БЖУ и тем что пользователи любят. Ну и накрутчиков надо отсечь. А еще посмотрим на средние величины и отклонения.</p>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="/category/dataanalitics.html">DataAnalitics</a></p>
                    </aside>
                    <hr/>
                </article>
    </div>
        </main>
        <footer id="colophon" class="site-footer inner">
          <div class="site-footer-inside">
            <span class="copyright">Опубликовано с удовольствием 2019-2020</span>
          </div>
          <a id="to-top" class="to-top" href="https://themes.stackbit.com/demos/fjord/#page">
            To top
            <span class="icon-arrow-up" aria-hidden="true"></span>
          </a>
        </footer>
      </div>

        </div>

        <script src="/theme/js/main.js" type="text/javascript"></script>
        <script src="/theme/js/plugins.js" type="text/javascript"></script>
        <!-- Yandex.Metrika counter -->
        <script type="text/javascript" >
           (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
           m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
           (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

           ym(69735988, "init", {
                clickmap:true,
                trackLinks:true,
                accurateTrackBounce:true
           });
        </script>
        <noscript><div><img src="https://mc.yandex.ru/watch/69735988" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
        <!-- /Yandex.Metrika counter -->
    </body>



<!--               

 -->